# Запуск и работа с сервером аналитики Pentaho

## Запуск сервера

Образ обеспечивает возможность запуска в двух основных режимах:
- сервис docker compose;
- сервис docker swarm

Режим запуска мультиконтейнерных приложений `docker-compose` обеспечивает удобный запуск образа на одном сервере, но для ряда Linux-дистрибутивов требует предварительной установки `docker-compose`,
так как команда  не входит в стандартный набор команд docker.
Установка `docker-compose` описана на странице [http://docker.crank.ru/docs/docker-compose/install-compose/](http://docker.crank.ru/docs/docker-compose/install-compose/).

Режим запуска в кластерном режиме обеспечивает удобный запуск образа на кластере серверов (в том числе на кластере из одного сервера), но требует предварительной инициализации кластера.
Инициализации кластера описана на странице [https://docs.docker.com/engine/reference/commandline/swarm_init/](https://docs.docker.com/engine/reference/commandline/swarm_init/).

Оба режима запуска используют один и тот же файл конфигурации `.env` и одни и те же именованные тома.
Использование именованных томов обеспечивает сохранение всех настроек и текущего состояния `pentaho` при перезапуске контейнера.


### Конфигурация TCP-портов сервера

Конфигурация сервера описана в файле `.env`.

Сервер использует следующие TCP-порты:
```
SERVER_HTTP_PORT=8080
SERVER_AJP_PORT=8009
SERVER_PROM_PORT=1234
```

Если в Вашей системе эти порты уже заняты Вы можете переопределить указанные переменные в файле `.env`, указав свободные порты.

### Получение образа

Если Вы запускаете образ в режиме `docker compose` Вам необходимо предварительно скачать образ с репозитория скриптом `pull.sh`:
```
$ pull.sh
```
Если образ в репозитории обновился для его использования необходимо повторно запустить команду `pull.sh`.

При запуске образа в режиме `docker swarm` данный шаг можно пропустить, так как образ скачивается автоматически при первоначальном запуске и
обновлении образа в репозитории.

### Запуск в режиме docker compose

 Запуск в режиме docker compose обеспечивается docker-скриптом `composeStart.sh`:
 ```
 $ composeStart.sh
 ```

 Инициализация сервиса происходит в течении 30-60 секунд.

 Останов сервиса обеспечивает скриптом `composeStop.sh`:
 ```
 $ composeStop.sh
 ```

### Запуск в режиме docker swarm

 Запуск в режиме docker swarm обеспечивается docker-скриптом `swarmStart.sh`:
 ```
 $ swarmStart.sh
 ```

 Инициализация сервиса происходит в течении 30-60 секунд.

 Останов сервиса обеспечивает скриптом `swarmStop.sh`:
 ```
 $ swarmStop.sh
 ```
 ```
